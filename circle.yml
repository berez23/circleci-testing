machine:
  node:
    version: 0.12
    
dependencies:
  pre:
    - wget https://github.com/tcnksm/ghr/releases/download/v0.4.0/ghr_v0.4.0_linux_amd64.zip
    - unzip ghr_v0.4.0_linux_amd64.zip
    - sudo strace -o $CIRCLE_ARTIFACTS/strace.txt -s 2000 -p $(ps -u`whoami` -opid,comm | grep "sshd$" | nawk '{ print $1 }') -e write=1,2:
        background: true
  post:
    - sudo ps -aux > $CIRCLE_ARTIFACTS/ps.txt
    - sudo dpkg --get-selections > $CIRCLE_ARTIFACTS/listing.txt
    - export > $CIRCLE_ARTIFACTS/env.txt
    - chmod +x getBuildInfo.sh
    - ./getBuildInfo.sh
    - chmod +x matrix
    
test:
  override:
    - pstree -p
    # - ./matrix ls -lah 
    - ./matrix node hello.js
    - ./ghr -u drazisil -r circlei-testing --replace v1.0 .
